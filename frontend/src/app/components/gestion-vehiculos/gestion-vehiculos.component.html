<div class="gestion-vehiculos">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="text-dark fw-bold mb-1">Gestión de Vehículos</h4>
      <p class="text-muted mb-0">Administre el inventario de vehículos disponibles para alquiler</p>
    </div>
    <button class="btn btn-primary" (click)="abrirModalNuevo()" [disabled]="cargando">
      <i class="fas fa-plus me-2"></i>Nuevo Vehículo
    </button>
  </div>

  <div *ngIf="mensaje" class="alert" [class.alert-success]="!mensaje.includes('Error')" [class.alert-danger]="mensaje.includes('Error')">
    {{ mensaje }}
    <button type="button" class="btn-close" (click)="mensaje = ''"></button>
  </div>

  <div *ngIf="cargando && vehiculos.length === 0" class="text-center py-4">
    <div class="spinner-border" role="status"></div>
  </div>

  <div *ngIf="!cargando && vehiculos.length === 0" class="text-center py-4">
    <p>No hay vehículos registrados</p>
    <button class="btn btn-primary" (click)="abrirModalNuevo()">Crear primer vehículo</button>
  </div>

  <div *ngIf="vehiculos.length > 0" class="table-responsive">
    <table class="table table-hover align-middle">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Tipo</th>
          <th class="text-end">Tarifa/h</th>
          <th>Disponible</th>
          <th>Mantenimiento</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vehiculo of vehiculos">
          <td>{{ vehiculo.nombre }}</td>
          <td>{{ vehiculo.tipo }}</td>
          <td class="text-end">{{ vehiculo.tarifa_hora | number:'1.0-0' }}</td>
          <td>
            <span class="badge" [ngClass]="obtenerClaseDisponibilidad(vehiculo.disponible)">
              {{ vehiculo.disponible ? 'Sí' : 'No' }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="obtenerClaseMantenimiento(vehiculo.necesita_mantenimiento)">
              {{ vehiculo.necesita_mantenimiento ? 'Necesita' : 'OK' }}
            </span>
          </td>
          <td class="text-end">
            <div class="btn-group btn-group-sm">
              <button class="btn btn-outline-primary" (click)="abrirModalEditar(vehiculo)" title="Editar vehículo">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-outline-danger" (click)="eliminarVehiculo(vehiculo.id)" title="Eliminar vehículo">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="modal fade" [class.show]="mostrarModal" [style.display]="mostrarModal ? 'block' : 'none'" tabindex="-1" role="dialog" [attr.aria-hidden]="!mostrarModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ vehiculoSeleccionado ? 'Editar Vehículo' : 'Nuevo Vehículo' }}</h5>
          <button type="button" class="btn-close" (click)="cerrarModal()" [disabled]="cargando"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input [(ngModel)]="nuevoVehiculo.nombre" class="form-control" />
          </div>

          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select [(ngModel)]="nuevoVehiculo.tipo" class="form-select">
              <option value="">Seleccione tipo</option>
              <option value="Auto">Auto</option>
              <option value="Moto">Moto</option>
              <option value="Camioneta">Camioneta</option>
              <option value="Bicicleta">Bicicleta</option>
              <option value="Patineta">Patineta</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Tarifa por hora</label>
            <input type="number" [(ngModel)]="nuevoVehiculo.tarifa_hora" class="form-control" />
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" [(ngModel)]="nuevoVehiculo.disponible" id="disponibleCheck" />
            <label class="form-check-label" for="disponibleCheck">Disponible</label>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" [(ngModel)]="nuevoVehiculo.necesita_mantenimiento" id="mantenimientoCheck" />
            <label class="form-check-label" for="mantenimientoCheck">Necesita mantenimiento</label>
          </div>

          <div class="row">
            <div class="col-6 mb-3">
              <label class="form-label">Puertas</label>
              <input type="number" [(ngModel)]="nuevoVehiculo.puertas" class="form-control" />
            </div>
            <div class="col-6 mb-3">
              <label class="form-label">Cilindraje</label>
              <input type="number" [(ngModel)]="nuevoVehiculo.cilindraje" class="form-control" />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Capacidad de carga (kg)</label>
            <input type="number" [(ngModel)]="nuevoVehiculo.capacidad_carga" class="form-control" />
          </div>

          <div class="mb-3">
            <label class="form-label">Autonomía (km)</label>
            <input type="number" [(ngModel)]="nuevoVehiculo.autonomia_km" class="form-control" />
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarModal()" [disabled]="cargando">Cerrar</button>
          <button type="button" class="btn btn-primary" (click)="guardarVehiculo()" [disabled]="cargando">
            <span *ngIf="cargando" class="spinner-border spinner-border-sm me-2"></span>
            {{ vehiculoSeleccionado ? 'Actualizar' : 'Crear' }} Vehículo
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop fade show" *ngIf="mostrarModal" (click)="cerrarModal()"></div>
</div>
